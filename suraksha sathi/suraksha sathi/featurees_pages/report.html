<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MineSafe Hazard Report</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Framer Motion Web (for simple fade/slide) -->
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
    }

    body {
      min-height: max(884px, 100dvh);
    }

    /* Glassmorphism container */
    .glass-card {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
      border-radius: 1.25rem;
      border: 1px solid rgba(255, 255, 255, 0.18);
      color: #222;
    }

    .glass-card-dark {
      background: rgba(255, 255, 255, 0.7);
      /* Use light glass for light theme */
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
      border-radius: 1.25rem;
      border: 1px solid rgba(255, 255, 255, 0.18);
      color: #222;
    }

    .floating-label {
      position: relative;
    }

    .floating-label input,
    .floating-label textarea {
      padding-top: 1.5rem;
    }

    .floating-label label {
      position: absolute;
      left: 1rem;
      top: 1rem;
      font-size: 0.95rem;
      color: #888;
      pointer-events: none;
      transition: all 0.2s;
    }

    .floating-label input:focus+label,
    .floating-label input:not(:placeholder-shown)+label,
    .floating-label textarea:focus+label,
    .floating-label textarea:not(:placeholder-shown)+label {
      top: 0.2rem;
      left: 0.8rem;
      font-size: 0.8rem;
      color: #FFD700;
      opacity: 1;
    }

    .floating-label input:placeholder-shown+label,
    .floating-label textarea:placeholder-shown+label {
      opacity: 1;
    }

    .floating-label input:not(:placeholder-shown)+label,
    .floating-label textarea:not(:placeholder-shown)+label {
      opacity: 0;
      pointer-events: none;
    }

    input,
    textarea {
      color: #222 !important;
      background: #f7fafc !important;
    }

    .severity-btn {
      background: #f7fafc;
      color: #222;
    }

    .severity-btn.selected {
      color: inherit;
    }

    .severity-btn span {
      color: inherit;
    }

    #map {
      height: 250px;
      border-radius: 0.75rem;
    }

    .step {
      display: none;
    }

    .step.active {
      display: block;
    }

    /* Step transitions */
    .step-anim-enter {
      opacity: 0;
      transform: translateX(40px);
    }

    .step-anim-enter-active {
      opacity: 1;
      transform: translateX(0);
      transition: all 0.5s cubic-bezier(.4, 0, .2, 1);
    }

    .step-anim-exit {
      opacity: 1;
      transform: translateX(0);
    }

    .step-anim-exit-active {
      opacity: 0;
      transform: translateX(-40px);
      transition: all 0.5s cubic-bezier(.4, 0, .2, 1);
    }

    .progress-dots {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #e5e7eb;
      transition: background 0.3s;
    }

    .progress-dot.active {
      background: linear-gradient(90deg, #FFD700 60%, #28a745 100%);
      box-shadow: 0 0 8px #FFD70088;
    }

    .skeleton {
      background: linear-gradient(90deg, #f3f3f3 25%, #e2e2e2 50%, #f3f3f3 75%);
      background-size: 200% 100%;
      animation: skeleton 1.2s infinite linear;
    }

    @keyframes skeleton {
      0% {
        background-position: 200% 0;
      }

      100% {
        background-position: -200% 0;
      }
    }

    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      min-width: 220px;
      max-width: 90vw;
      background: rgba(30, 30, 30, 0.95);
      color: #fff;
      border-radius: 1rem;
      padding: 1rem 1.5rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
      font-size: 1rem;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s;
    }

    .toast.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* Carousel */
    .carousel {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .carousel-img {
      height: 5.5rem;
      width: 5.5rem;
      object-fit: cover;
      border-radius: 0.75rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
      border: 2px solid #FFD70022;
      transition: box-shadow 0.2s;
    }

    .carousel-img.selected {
      box-shadow: 0 4px 16px #FFD70044;
    }

    .carousel-remove {
      position: absolute;
      top: 0.3rem;
      right: 0.3rem;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      border-radius: 50%;
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1rem;
    }

    #hazard-description:focus {
      border-color: #e5e7eb !important;
      /* Safety yellow */
      box-shadow: 0 0 0 2px #e5e7eb;
    }

    #hazard-description {
      border-color: #e5e7eb !important;
      /* Neutral gray border */
    }
  </style>
</head>

<body class="bg-gray-50 font-display text-gray-900">

  <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
    <header class="flex items-center bg-white p-4 pb-3 justify-between sticky top-0 z-20 shadow-md glass-card">
      <button id="backBtn"
        class="flex items-center justify-center rounded-full transition hover:bg-gray-100 w-10 h-10 focus:outline-none focus:ring-2 focus:ring-yellow-400">
        <span class="material-symbols-outlined text-gray-700 text-2xl">arrow_back_ios_new</span>
      </button>
      <h2 class="flex-1 text-center text-xl font-bold tracking-tight text-gray-800 select-none"
        data-translate-key="title">Report a Hazard</h2>
      <button id="viewReportsBtn"
        class="flex items-center px-4 py-2 rounded-full bg-gradient-to-r from-green-500 to-yellow-400 text-white text-sm font-bold shadow hover:scale-105 transition focus:outline-none focus:ring-2 focus:ring-yellow-400">
        <span class="material-symbols-outlined mr-2 text-base">list_alt</span>
        <span data-translate-key="previous_button">Previous</span>
      </button>
    </header>

    <!-- Progress Dots -->
    <div class="progress-dots mt-2">
      <div class="progress-dot" id="dot0"></div>
      <div class="progress-dot" id="dot1"></div>
      <div class="progress-dot" id="dot2"></div>
      <div class="progress-dot" id="dot3"></div>
    </div>

    <main class="flex-1 px-4 py-6">
      <form id="hazardForm" class="space-y-6">

        <!-- Step 1: Hazard Description + Severity -->
        <div class="step active" id="step1">
          <div class="glass-card dark:glass-card-dark p-6 mb-4 shadow-severity">
            <div class="floating-label mb-6">
              <textarea id="hazard-description" name="hazard-description" rows="4" placeholder=" "
                class="w-full rounded-lg border-charcoal-gray/30 dark:border-[#324f67] bg-light-gray dark:bg-[#192833] p-3 text-base text-charcoal-gray dark:text-white focus:ring-safety-yellow focus:border-safety-yellow transition"></textarea>
              <label for="hazard-description" data-translate-key="describe_hazard_label">Describe the Hazard</label>
            </div>
            <div>
              <label class="block text-sm font-bold mb-2" data-translate-key="severity_level_label">Severity
                Level</label>
              <div class="grid grid-cols-3 gap-2">
                <button type="button"
                  class="severity-btn flex flex-col items-center justify-center gap-1 rounded-lg p-3 border-2 border-green-500 text-green-500 selected"
                  data-level="Low">
                  <span class="material-symbols-outlined text-3xl">check_circle</span>
                  <span class="text-sm font-bold" data-translate-key="severity_low">Low</span>
                </button>
                <button type="button"
                  class="severity-btn flex flex-col items-center justify-center gap-1 rounded-lg p-3 border-2 border-yellow-500 text-yellow-500"
                  data-level="Medium">
                  <span class="material-symbols-outlined text-3xl">warning</span>
                  <span class="text-sm font-bold" data-translate-key="severity_medium">Medium</span>
                </button>
                <button type="button"
                  class="severity-btn flex flex-col items-center justify-center gap-1 rounded-lg p-3 border-2 border-red-500 text-red-500"
                  data-level="High">
                  <span class="material-symbols-outlined text-3xl">dangerous</span>
                  <span class="text-sm font-bold" data-translate-key="severity_high">High</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Location -->
        <div class="step" id="step2">
          <div class="glass-card dark:glass-card-dark p-6 mb-4 shadow-severity">
            <div class="floating-label mb-4">
              <input type="text" id="location" name="location" placeholder=" "
                class="w-full rounded-lg border-charcoal-gray/30 dark:border-[#324f67] bg-light-gray dark:bg-[#192833] py-3 pl-3 pr-3 text-base text-charcoal-gray dark:text-white mb-2 transition"
                readonly />
              <label for="location" data-translate-key="location_label">Location</label>
            </div>
            <div id="map" class="mb-2"></div>
            <div id="locationSkeleton" class="skeleton h-6 w-2/3 rounded mb-2 hidden"></div>
          </div>
        </div>

        <!-- Step 3: Photo/Video Upload -->
        <div class="step" id="step3">
          <div class="glass-card dark:glass-card-dark p-6 mb-4 shadow-severity">
            <label class="block text-sm font-bold mb-2" data-translate-key="add_photos_label">Add Photo(s)</label>
            <div class="flex items-center justify-center gap-4">
              <button type="button" id="uploadBtn"
                class="flex h-20 w-20 flex-col items-center justify-center rounded-lg border-2 border-dashed border-charcoal-gray/30 dark:border-[#324f67] bg-light-gray dark:bg-[#192833] hover:bg-safety-yellow/10 transition shadow">
                <span
                  class="material-symbols-outlined text-4xl text-charcoal-gray/60 dark:text-white/60">add_a_photo</span>
                <span class="text-xs text-charcoal-gray/60 dark:text-white/60 mt-1"
                  data-translate-key="upload_button">Upload</span>
              </button>
              <div id="carouselPreview" class="carousel"></div>
            </div>
            <input type="file" id="cameraInput" accept="image/*" capture="environment" class="hidden" multiple />
            <input type="file" id="fileInput" accept="image/*" class="hidden" multiple />
          </div>
        </div>

        <!-- Step 4: Preview & Confirm -->
        <div class="step" id="step4">
          <div class="glass-card dark:glass-card-dark p-6 mb-4 shadow-severity">
            <h3 class="text-lg font-bold mb-2 flex items-center gap-2">
              <span class="material-symbols-outlined text-safety-yellow">preview</span> <span
                data-translate-key="preview_report_title">Preview Report</span>
            </h3>
            <div class="mb-2">
              <span class="font-bold" data-translate-key="preview_desc">Description:</span>
              <span id="previewDesc" class="ml-2"></span>
            </div>
            <div class="mb-2">
              <span class="font-bold" data-translate-key="preview_severity">Severity:</span>
              <span id="previewSeverity" class="ml-2"></span>
            </div>
            <div class="mb-2">
              <span class="font-bold" data-translate-key="preview_location">Location:</span>
              <span id="previewLocation" class="ml-2"></span>
            </div>
            <div class="mb-2">
              <span class="font-bold" data-translate-key="preview_photos">Photos:</span>
              <div id="previewPhotos" class="flex gap-2 mt-2"></div>
            </div>
            <button type="button" id="saveDraftBtn"
              class="mt-4 px-4 py-2 rounded-lg bg-brand-yellow text-charcoal-gray font-bold shadow hover:bg-yellow-400 transition">
              <span class="material-symbols-outlined text-base mr-1">save</span> <span
                data-translate-key="save_draft_button">Save Draft</span>
            </button>
          </div>
        </div>

      </form>
    </main>

    <div
      class="sticky bottom-0 left-0 right-0 bg-white p-4 border-t border-gray-200 flex justify-between glass-card shadow-lg">
      <button id="prevBtn"
        class="px-6 py-3 rounded-xl bg-gray-500 text-white font-bold shadow hover:bg-gray-500 transition"
        data-translate-key="back_button">Back</button>
      <button id="nextBtn"
        class="px-6 py-3 rounded-xl bg-gradient-to-r from-red-500 to-yellow-400 text-white font-bold shadow hover:scale-105 transition"
        data-translate-key="next_button">Next</button>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black/40 flex items-center justify-center z-[9999] hidden">
      <div class="glass-card dark:glass-card-dark p-8 rounded-xl shadow-lg max-w-md w-full">
        <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
          <span class="material-symbols-outlined text-safety-yellow">check_circle</span>
          <span data-translate-key="confirm_submission_title">Confirm Submission</span>
        </h3>
        <p class="mb-6" data-translate-key="confirm_submission_text">Are you sure you want to submit this hazard report?
        </p>
        <div class="flex justify-end gap-4">
          <button id="cancelModalBtn"
            class="px-4 py-2 rounded-lg bg-gray-300 text-charcoal-gray font-bold hover:bg-gray-400 transition"
            data-translate-key="cancel_button">Cancel</button>
          <button id="confirmModalBtn"
            class="px-4 py-2 rounded-lg font-bold text-white bg-red-600 hover:bg-red-700 active:scale-95 transition-all duration-200 shadow-md hover:shadow-lg"
            data-translate-key="submit_button">
            Submit
          </button>
        </div>
      </div>
    </div>

    <script>
      // --- Translations Object ---
      const translations = {
        toast_describe_hazard: { en: "Please describe the hazard.", hi: "कृपया खतरे का वर्णन करें।" },
        toast_location_not_detected: { en: "Location not detected yet.", hi: "स्थान का अभी तक पता नहीं चला है।" },
        toast_upload_photo: { en: "Please upload at least one photo.", hi: "कृपया कम से कम एक फ़ोटो अपलोड करें।" },
        toast_severity_set: { en: "Severity set to {level}", hi: "गंभीरता {level} पर सेट है" },
        toast_photos_uploaded: { en: "Photo(s) uploaded.", hi: "फोटो अपलोड हो गई हैं।" },
        toast_draft_saved: { en: "Draft saved!", hi: "ड्राफ़्ट सहेज लिया गया है!" },
        toast_report_submitted: { en: "Hazard report submitted!", hi: "खतरे की रिपोर्ट सबमिट कर दी गई है!" },
        toast_location_error: { en: "Location error: {message}", hi: "स्थान त्रुटि: {message}" },
        toast_geolocation_unsupported: { en: "Geolocation not supported.", hi: "जियोलोकेशन समर्थित नहीं है।" },
        next_button: { en: "Next", hi: "अगला" },
        submit_button_nav: { en: "Submit", hi: "सबमिट करें" },
      };

      let currentLang = 'en'; // Default language

      // --- Utility: Toast Notification ---
      function showToast(msg, type = 'info', key, params) {
        const toast = document.getElementById('toast');

        let translatedMsg = msg;
        if (key && translations[key] && translations[key][currentLang]) {
          translatedMsg = translations[key][currentLang];
          if (params) {
            for (const p in params) {
              translatedMsg = translatedMsg.replace(`{${p}}`, params[p]);
            }
          }
        }

        toast.textContent = translatedMsg;
        toast.className = 'toast show';
        if (type === 'error') toast.style.background = '#dc3545';
        else if (type === 'success') toast.style.background = '#28a745';
        else toast.style.background = 'rgba(30,30,30,0.95)';
        setTimeout(() => { toast.className = 'toast'; }, 2600);
      }

      // --- Step Navigation & Animation ---
      let currentStep = 0;
      const steps = Array.from(document.querySelectorAll(".step"));
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const progressDots = Array.from(document.querySelectorAll('.progress-dot'));

      // Fix: Always show only the current step
      function showStep(n) {
        steps.forEach((s, i) => {
          s.classList.toggle('active', i === n);
        });
        progressDots.forEach((dot, i) => dot.classList.toggle('active', i === n));
        prevBtn.disabled = n === 0;

        const nextTextKey = n === steps.length - 1 ? 'submit_button_nav' : 'next_button';
        if (translations[nextTextKey] && translations[nextTextKey][currentLang]) {
          nextBtn.textContent = translations[nextTextKey][currentLang];
        } else {
          nextBtn.textContent = n === steps.length - 1 ? "Submit" : "Next";
        }
      }

      function animateStepChange(n) {
        // Remove animation classes from all steps
        steps.forEach((s) => { s.classList.remove('step-anim-enter', 'step-anim-enter-active'); });
        // Show only the current step
        showStep(n);
        // Animate current step
        const s = steps[n];
        s.classList.add('step-anim-enter');
        setTimeout(() => { s.classList.add('step-anim-enter-active'); }, 10);
        setTimeout(() => { s.classList.remove('step-anim-enter', 'step-anim-enter-active'); }, 510);
      }

      nextBtn.addEventListener("click", async () => {
        if (currentStep < steps.length - 1) {
          // Validate step before moving
          if (currentStep === 0 && !document.getElementById("hazard-description").value.trim()) {
            showToast("Please describe the hazard.", "error", "toast_describe_hazard"); return;
          }
          if (currentStep === 1 && !document.getElementById("location").value.trim()) {
            showToast("Location not detected yet.", "error", "toast_location_not_detected"); return;
          }
          if (currentStep === 2 && photoFiles.length === 0) {
            showToast("Please upload at least one photo.", "error", "toast_upload_photo"); return;
          }
          currentStep++;
          updatePreview();
          animateStepChange(currentStep);
        } else {
          // Show confirmation modal
          document.getElementById('confirmModal').classList.remove('hidden');
        }
      });
      prevBtn.addEventListener("click", () => {
        if (currentStep > 0) {
          currentStep--;
          animateStepChange(currentStep);
        }
      });
      showStep(currentStep);

      // --- Progress Dots ---
      function updateProgressDots() {
        progressDots.forEach((dot, i) => dot.classList.toggle('active', i === currentStep));
      }
      updateProgressDots();

      // --- Back Button ---
      document.getElementById("backBtn").addEventListener("click", () => { history.back(); });

      // --- Severity Selection ---
      const severityBtns = document.querySelectorAll(".severity-btn");
      let selectedSeverity = "Low";
      severityBtns.forEach(btn => {
        btn.addEventListener("click", () => {
          severityBtns.forEach(b => b.classList.remove("selected", "border-green-500", "border-yellow-500", "border-red-500", "text-green-500", "text-yellow-500", "text-red-500", "bg-green-100", "bg-yellow-100", "bg-red-100"));
          btn.classList.add("selected");
          const level = btn.dataset.level;
          selectedSeverity = level;
          if (level === "Low") btn.classList.add("border-green-500", "text-green-500", "bg-green-100");
          if (level === "Medium") btn.classList.add("border-yellow-500", "text-yellow-500", "bg-yellow-100");
          if (level === "High") btn.classList.add("border-red-500", "text-red-500", "bg-red-100");
          showToast(`Severity set to ${level}`, "info", "toast_severity_set", { level: level });
        });
      });

      // --- Multiple Photo Upload & Carousel ---
      const uploadBtn = document.getElementById("uploadBtn");
      const cameraInput = document.getElementById("cameraInput");
      const fileInput = document.getElementById("fileInput");
      const carouselPreview = document.getElementById("carouselPreview");
      let photoFiles = [];

      uploadBtn.addEventListener("click", () => {
        // Fix: Use fileInput for all devices, cameraInput for mobile only
        if (window.matchMedia("(max-width: 600px)").matches) {
          cameraInput.click();
        } else {
          fileInput.click();
        }
      });

      [cameraInput, fileInput].forEach(input => {
        input.addEventListener("change", async e => {
          if (e.target.files && e.target.files.length > 0) {
            for (const file of e.target.files) {
              if (!file.type.startsWith('image/')) continue;
              const reader = new FileReader();
              reader.onload = function (ev) {
                photoFiles.push(ev.target.result);
                renderCarousel();
              }
              reader.readAsDataURL(file);
            }
            showToast("Photo(s) uploaded.", "success", "toast_photos_uploaded");
          }
        });
      });

      function renderCarousel() {
        carouselPreview.innerHTML = '';
        photoFiles.forEach((src, idx) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'relative';
          const img = document.createElement('img');
          img.src = src;
          img.className = 'carousel-img';
          wrapper.appendChild(img);
          const removeBtn = document.createElement('span');
          removeBtn.className = 'carousel-remove material-symbols-outlined';
          removeBtn.textContent = 'close';
          removeBtn.onclick = () => { photoFiles.splice(idx, 1); renderCarousel(); }
          wrapper.appendChild(removeBtn);
          carouselPreview.appendChild(wrapper);
        });
      }

      // --- Leaflet Map & Location ---
      let map, marker = null, circle = null;
      const locationInput = document.getElementById("location");
      const locationSkeleton = document.getElementById("locationSkeleton");
      function showLocationSkeleton(show = true) {
        locationSkeleton.style.display = show ? 'block' : 'none';
        locationInput.style.display = show ? 'none' : 'block';
      }
      async function getLocationAsync() {
        showLocationSkeleton(true);
        return new Promise((resolve, reject) => {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
              showLocationSkeleton(false);
              resolve(pos);
            }, err => {
              showLocationSkeleton(false);
              showToast("Location error: " + err.message, "error", "toast_location_error", { message: err.message });
              reject(err);
            });
          } else {
            showLocationSkeleton(false);
            showToast("Geolocation not supported.", "error", "toast_geolocation_unsupported");
            reject(new Error("Geolocation not supported"));
          }
        });
      }
      function animateMarkerDrop(latlng) {
        if (marker) map.removeLayer(marker);
        marker = L.marker(latlng, { draggable: true, opacity: 0 }).addTo(map);
        setTimeout(() => { marker.setOpacity(1); }, 200);
        marker.on('dragend', e => {
          const p = e.target.getLatLng();
          locationInput.value = `Lat: ${p.lat.toFixed(5)}, Lng: ${p.lng.toFixed(5)}`;
          if (circle) circle.setLatLng(p);
        });
      }
      function drawRadiusCircle(latlng) {
        if (circle) map.removeLayer(circle);
        circle = L.circle(latlng, { radius: 500, color: '#FFD700', fillColor: '#FFD70022', fillOpacity: 0.2 }).addTo(map);
      }
      window.addEventListener('DOMContentLoaded', async () => {
        map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
        try {
          const pos = await getLocationAsync();
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;
          map.setView([lat, lng], 16);
          animateMarkerDrop([lat, lng]);
          drawRadiusCircle([lat, lng]);
          locationInput.value = `Lat: ${lat.toFixed(5)}, Lng: ${lng.toFixed(5)}`;
        } catch { }
        map.on('click', e => {
          animateMarkerDrop(e.latlng);
          drawRadiusCircle(e.latlng);
          locationInput.value = `Lat: ${e.latlng.lat.toFixed(5)}, Lng: ${e.latlng.lng.toFixed(5)}`;
        });
      });

      // --- Preview Step ---
      function updatePreview() {
        document.getElementById('previewDesc').textContent = document.getElementById("hazard-description").value;
        document.getElementById('previewSeverity').textContent = selectedSeverity;
        document.getElementById('previewLocation').textContent = locationInput.value;
        const previewPhotos = document.getElementById('previewPhotos');
        previewPhotos.innerHTML = '';
        photoFiles.forEach(src => {
          const img = document.createElement('img');
          img.src = src;
          img.className = 'carousel-img';
          previewPhotos.appendChild(img);
        });
      }

      // --- Save Draft Feature ---
      document.getElementById('saveDraftBtn').addEventListener('click', () => {
        const draft = {
          description: document.getElementById("hazard-description").value,
          location: locationInput.value,
          severity: selectedSeverity,
          photos: photoFiles
        };
        localStorage.setItem('hazardDraft', JSON.stringify(draft));
        showToast("Draft saved!", "success", "toast_draft_saved");
      });

      // --- View Previous Reports ---
      document.getElementById('viewReportsBtn').addEventListener('click', () => {
        window.location.href = '/app/featurees_pages/reports_list.html'; // Change path as needed
      });

      // --- Confirmation Modal ---
      document.getElementById('cancelModalBtn').addEventListener('click', () => {
        document.getElementById('confirmModal').classList.add('hidden');
      });
      document.getElementById('confirmModalBtn').addEventListener('click', () => {
        submitForm();
        document.getElementById('confirmModal').classList.add('hidden');
      });

      // --- Submit Form ---
      function submitForm() {
        const hazardDesc = document.getElementById("hazard-description").value;
        const location = locationInput.value;
        const reportData = {
          description: hazardDesc,
          location: location,
          severity: selectedSeverity,
          photos: photoFiles
        };
        // Save to localStorage for demo
        let reports = JSON.parse(localStorage.getItem('hazardReports') || '[]');
        reports.push(reportData);
        localStorage.setItem('hazardReports', JSON.stringify(reports));
        showToast("Hazard report submitted!", "success", "toast_report_submitted");
        setTimeout(() => { window.location.reload(); }, 1200);
      }

      // --- Accessibility: Keyboard Navigation ---
      document.addEventListener('keydown', e => {
        if (e.key === 'ArrowRight' && !nextBtn.disabled) nextBtn.click();
        if (e.key === 'ArrowLeft' && !prevBtn.disabled) prevBtn.click();
      });

      // --- Error Handling for uploads ---
      window.addEventListener('error', e => {
        showToast("Error: " + e.message, "error");
      });
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const pageTranslations = {
          title: { en: "Report a Hazard", hi: "खतरे की रिपोर्ट करें" },
          previous_button: { en: "Previous", hi: "पिछला" },
          describe_hazard_label: { en: "Describe the Hazard", hi: "खतरे का वर्णन करें" },
          severity_level_label: { en: "Severity Level", hi: "गंभीरता स्तर" },
          severity_low: { en: "Low", hi: "कम" },
          severity_medium: { en: "Medium", hi: "मध्यम" },
          severity_high: { en: "High", hi: "उच्च" },
          location_label: { en: "Location", hi: "स्थान" },
          add_photos_label: { en: "Add Photo(s)", hi: "फोटो जोड़ें" },
          upload_button: { en: "Upload", hi: "अपलोड" },
          preview_report_title: { en: "Preview Report", hi: "रिपोर्ट का पूर्वावलोकन करें" },
          preview_desc: { en: "Description:", hi: "विवरण:" },
          preview_severity: { en: "Severity:", hi: "गंभीरता:" },
          preview_location: { en: "Location:", hi: "स्थान:" },
          preview_photos: { en: "Photos:", hi: "तस्वीरें:" },
          save_draft_button: { en: "Save Draft", hi: "ड्राफ़्ट सहेजें" },
          back_button: { en: "Back", hi: "वापस" },
          next_button: { en: "Next", hi: "अगला" },
          confirm_submission_title: { en: "Confirm Submission", hi: "सबमिशन की पुष्टि करें" },
          confirm_submission_text: { en: "Are you sure you want to submit this hazard report?", hi: "क्या आप वाकई यह खतरा रिपोर्ट सबमिट करना चाहते हैं?" },
          cancel_button: { en: "Cancel", hi: "रद्द करें" },
          submit_button: { en: "Submit", hi: "सबमिट करें" },
          submit_button_nav: { en: "Submit", hi: "सबमिट करें" },
        };

        currentLang = localStorage.getItem('lang') || 'en';

        function applyLanguage(lang) {
          document.documentElement.lang = lang;
          document.querySelectorAll('[data-translate-key]').forEach(element => {
            const key = element.getAttribute('data-translate-key');
            if (pageTranslations[key] && pageTranslations[key][lang]) {
              element.textContent = pageTranslations[key][lang];
            }
          });
          const titleKey = 'title';
          if (pageTranslations[titleKey] && pageTranslations[titleKey][lang]) {
            document.title = pageTranslations[titleKey][lang];
          }
          showStep(currentStep); // Re-render button text
        }

        applyLanguage(currentLang);
      });
    </script>
</body>

</html>