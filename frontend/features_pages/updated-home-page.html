<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MineSafe Safety Hub</title>

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,0..200"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&display=swap" rel="stylesheet">

    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0284c7", // sky-600
                        "primary-dark": "#0369a1", // sky-700
                        "primary-light": "#7dd3fc", // sky-300
                        "secondary": "#f97316", // orange-500
                        "background-light": "#f8fafc", // slate-50
                        "surface-light": "#ffffff",
                        "surface-light-alt": "#f1f5f9", // slate-100
                        "safety-yellow": "#facc15", // yellow-400
                        "safety-orange": "#f97316", // orange-500
                        "alert-red": "#ef4444", // red-500
                        "success-green": "#22c55e", // green-500
                        "neutral-50": "#f8fafc",
                        "neutral-100": "#f1f5f9",
                        "neutral-200": "#e2e8f0",
                        "neutral-300": "#cbd5e1",
                        "neutral-400": "#94a3b8",
                        "neutral-500": "#64748b",
                        "neutral-600": "#475569",
                        "neutral-700": "#334155",
                        "neutral-800": "#1e293b",
                        "neutral-900": "#0f172a",
                        "person-blue": "#3b82f6", // blue-500
                        "badge-gold": "#eab308", // yellow-500
                        "badge-silver": "#94a3b8", // slate-400
                        "badge-bronze": "#b45309", // amber-700
                        "badge-blue": "#3b82f6", // blue-500
                        "badge-green": "#22c55e", // green-500
                        "badge-purple": "#a855f7", // purple-500
                        "badge-orange": "#f97316", // orange-500
                    },
                    fontFamily: {
                        "sans": ["Inter", "sans-serif"],
                        "orbitron": ["Orbitron", "sans-serif"],
                    },
                    borderRadius: {
                        "4xl": "2rem",
                    },
                    boxShadow: {
                        'card': '0 2px 4px -1px rgba(0, 0, 0, 0.06), 0 1px 2px -1px rgba(0, 0, 0, 0.03)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.03)',
                        'bottom-nav': '0 -1px 5px rgba(0, 0, 0, 0.05)',
                        'floating-action': '0 4px 14px rgba(2, 132, 199, 0.4)',
                    },
                    keyframes: {
                        progressBar: {
                            "0%": {
                                width: "0%"
                            },
                            "100%": {
                                width: "var(--progress-width)"
                            },
                        },
                        pulseOutline: {
                            "0%, 100%": {
                                boxShadow: "0 0 0 0 rgba(255, 59, 48, 0.7)"
                            },
                            "50%": {
                                boxShadow: "0 0 0 8px rgba(255, 59, 48, 0)"
                            },
                        },
                        badgePop: {
                            "0%": {
                                transform: "scale(0.5)",
                                opacity: "0"
                            },
                            "70%": {
                                transform: "scale(1.1)",
                                opacity: "1"
                            },
                            "100%": {
                                transform: "scale(1)",
                                opacity: "1"
                            },
                        },
                        fadeIn: {
                            "0%": {
                                opacity: "0"
                            },
                            "100%": {
                                opacity: "1"
                            },
                        },
                        slideInUp: {
                            "0%": {
                                transform: "translateY(10px)",
                                opacity: "0"
                            },
                            "100%": {
                                transform: "translateY(0)",
                                opacity: "1"
                            },
                        },
                        pulse: {
                            "0%, 100%": {
                                opacity: "1"
                            },
                            "50%": {
                                opacity: "0.6"
                            },
                        },
                    },
                    animation: {
                        progressBar: "progressBar 1.2s ease-out forwards",
                        pulseOutline: "pulseOutline 2s infinite",
                        badgePop: "badgePop 0.5s ease-out forwards",
                        fadeIn: "fadeIn 0.4s ease-out forwards",
                        slideInUp: "slideInUp 0.5s ease-out forwards",
                        pulse: "pulse 2s infinite",
                    },
                },
            },
        };
    </script>

    <style type="text/tailwindcss">
        .material-symbols-rounded {
            font-variation-settings: "FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24;
        }

        /* Menu toggle */
        #menu-toggle:checked+#menu {
            display: block;
            opacity: 1;
            transform: translateY(0);
            max-height: 100vh;
        }

        /* Glass morphism effect */
        .glassmorphism {
            @apply backdrop-blur-md bg-white/80 border border-white/80;
        }

        /* Card animations */
        .card-hover {
            @apply transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1;
        }

        /* Badge style */
        .badge {
            @apply inline-flex items-center justify-center text-xs font-medium px-2 py-0.5 rounded-full;
        }

        /* Make sure buttons are perfectly round when needed */
        .aspect-square {
            aspect-ratio: 1 / 1;
        }
    </style>

    <style>
        .progress-bar-animated {
            animation: progressBar 1.2s ease-out forwards;
        }
    </style>

    <style>
        .badge-icon {
            background-repeat: no-repeat;
            background-position: center;
            background-size: 60%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Body minimum height */
        body {
            min-height: 100dvh;
            overscroll-behavior: none;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        ::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        html {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        /* Animation delay utility classes */
        .delay-100 {
            animation-delay: 0.1s;
        }

        .delay-200 {
            animation-delay: 0.2s;
        }

        .delay-300 {
            animation-delay: 0.3s;
        }

        .delay-400 {
            animation-delay: 0.4s;
        }

        .delay-500 {
            animation-delay: 0.5s;
        }

        /* Styles from chatbot.html */
        :root {
            --primary-blue: #0284c7;
            --primary-orange: #f97316;
            --bot-bg: #f1f5f9;
            --bot-text: #1e293b;
            --user-bg: var(--primary-blue);
        }

        #chat-window {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .chat-bubble {
            max-width: 85%;
        }

        .chat-bubble-user {
            background-color: var(--user-bg);
            color: white;
        }

        .chat-bubble-bot {
            background-color: var(--bot-bg);
            color: var(--bot-text);
        }

        .thinking-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #94a3b8;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .thinking-indicator span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .thinking-indicator span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1.0);
            }
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 12px rgba(2, 132, 199, 0.5);
            }

            50% {
                box-shadow: 0 0 20px 4px rgba(2, 132, 199, 0.8);
            }
        }
    </style>

    <style>
        /* Add these styles to the existing <style> section */
        @keyframes spin-slow {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin-slow {
            animation: spin-slow 2s linear infinite;
        }

        .nav-link {
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            transform: translateY(-2px);
        }

        .nav-icon-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav-icon-wrapper::after {
            content: '';
            position: absolute;
            width: 32px;
            height: 32px;
            background: currentColor;
            border-radius: 50%;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .nav-link:hover .nav-icon-wrapper::after {
            opacity: 0.1;
            transform: scale(1);
        }

        .nav-link.active {
            position: relative;
        }

        .nav-link.active::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 3px;
            background: currentColor;
            border-radius: 3px 3px 0 0;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize dynamic behaviors
            const dynamicBehaviors = {
                initializeMineMap() {
                    // Map initialization logic here
                    const mineMap = document.querySelector('.mine-map');
                    if (mineMap) {
                        // Add pulse animation to danger zones
                        const dangerZones = mineMap.querySelectorAll('.danger-zone');
                        dangerZones.forEach(zone => {
                            zone.classList.add('animate-pulse-outline');
                        });
                    }
                },

                initializeProgressBars() {
                    // Find all progress bars
                    const progressBars = document.querySelectorAll('[data-progress]');
                    progressBars.forEach(bar => {
                        const progress = bar.getAttribute('data-progress');
                        bar.style.setProperty('--progress-width', `${progress}%`);
                        bar.classList.add('animate-progress-bar');
                    });
                },

                initializeAchievements() {
                    // Trigger badge pop animation when they come into view
                    const badges = document.querySelectorAll('.achievement-badge');
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('animate-badge-pop');
                            }
                        });
                    });
                    badges.forEach(badge => observer.observe(badge));
                },

                initializeAlerts() {
                    // Handle alert interactions
                    const alerts = document.querySelectorAll('.alert-item');
                    alerts.forEach(alert => {
                        alert.addEventListener('click', function () {
                            this.classList.add('animate-slide-in-up');
                            // Add your alert handling logic here
                        });
                    });
                },

                initializeSearch() {
                    // Handle search interactions
                    const searchInput = document.querySelector('#search-input');
                    const searchResults = document.querySelector('#search-results');
                    if (searchInput && searchResults) {
                        searchInput.addEventListener('input', function () {
                            if (this.value.length > 0) {
                                searchResults.classList.remove('hidden');
                                searchResults.classList.add('animate-fade-in');
                            } else {
                                searchResults.classList.add('hidden');
                                searchResults.classList.remove('animate-fade-in');
                            }
                        });
                    }
                },

                initializeNavigation() {
                    // Handle navigation interactions
                    const menuTrigger = document.querySelector('#menu-trigger');
                    const mobileMenu = document.querySelector('#mobile-menu');
                    if (menuTrigger && mobileMenu) {
                        menuTrigger.addEventListener('click', function () {
                            mobileMenu.classList.toggle('hidden');
                            if (!mobileMenu.classList.contains('hidden')) {
                                mobileMenu.classList.add('animate-slide-in-up');
                            }
                        });
                    }
                },

                initializeRecentActivity() {
                    // Expand/collapse activity details
                    const activityItems = document.querySelectorAll('.activity-item');
                    activityItems.forEach(item => {
                        item.addEventListener('click', function () {
                            const details = this.querySelector('.activity-details');
                            const isOpen = details.classList.contains('max-h-0');

                            // Close all other items
                            activityItems.forEach(i => {
                                if (i !== this) {
                                    i.querySelector('.activity-details').classList.add('max-h-0');
                                    i.querySelector('.activity-details').style.opacity = '0';
                                }
                            });

                            // Toggle this item
                            if (isOpen) {
                                details.classList.remove('max-h-0');
                                details.style.opacity = '1';
                            } else {
                                details.classList.add('max-h-0');
                                details.style.opacity = '0';
                            }
                        });
                    });
                },

                initializeProgressAnimation() {
                    // Animate progress bars
                    const progressRows = document.querySelectorAll('.progress-row');
                    progressRows.forEach(row => {
                        const target = row.getAttribute('data-target');
                        const progressBar = row.querySelector('.progress-bar');
                        const progressValue = row.querySelector('.progress-value');

                        // Animate width and update value
                        setTimeout(() => {
                            progressBar.style.width = `${target}%`;
                            progressValue.textContent = `${target}%`;
                        }, 100);
                    });
                },
            };

            // Initialize all dynamic behaviors
            Object.values(dynamicBehaviors).forEach(init => init());
        });
    </script>
</head>

<body class="bg-gradient-to-br from-neutral-50 to-neutral-100 font-sans text-neutral-800 min-h-screen pb-20">

    <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">

        <div
            class="sticky top-0 z-50 flex items-center bg-gradient-to-r from-[#020617] via-[#0f172a] to-[#000000] px-4 py-3 justify-between shadow-lg shadow-blue-900/40 border-b border-blue-900/40">

            <div class="flex size-12 shrink-0 items-center justify-center relative">
                <input class="hidden" id="menu-toggle" type="checkbox" />
                <label class="cursor-pointer" for="menu-toggle">
                    <span class="material-symbols-rounded text-white text-2xl">menu</span>
                </label>

                <div class="absolute top-12 left-0 w-64 bg-[#0f172a]/90 backdrop-blur-md border border-white/10 rounded-lg shadow-lg shadow-black/40 z-10 max-h-0 opacity-0 overflow-hidden transition-all duration-300 ease-in-out"
                    id="menu">
                    <div class="p-4 space-y-3 relative">
                        <div
                            class="absolute inset-0 bg-gradient-to-b from-white/5 to-transparent pointer-events-none rounded-lg">
                        </div>

                        <a href="profile_setting.html"
                            class="flex items-center space-x-3 text-white/90 hover:bg-white/15 hover:text-white p-2 rounded-md transition-colors duration-150 relative">
                            <span class="material-symbols-rounded">settings</span>
                            <span data-translate-key="settings">Settings</span>
                        </a>
                        <a href="attendece.html"
                            class="flex items-center space-x-3 text-white/90 hover:bg-white/15 hover:text-white p-2 rounded-md transition-colors duration-150 relative">
                            <span class="material-symbols-rounded">history</span>
                            <span data-translate-key="attendance">Attendance</span>
                        </a>
                        <a href="video_library.html"
                            class="flex items-center space-x-3 text-white/90 hover:bg-white/15 hover:text-white p-2 rounded-md transition-colors duration-150 relative">
                            <span class="material-symbols-rounded">video_library</span>
                            <span data-translate-key="video_library_menu">Video
                                Library</span>
                        </a>

                        <div
                            class="flex items-center justify-between text-white/90 bg-white/10 hover:bg-white/15 p-2 rounded-md transition-colors duration-150">
                            <a href="#"
                                class="flex items-center space-x-3 text-white/90 hover:bg-white/15 hover:text-white p-2 rounded-md transition-colors duration-150 relative">
                                <span class="material-symbols-rounded">translate</span>
                                <span data-translate-key="language">Language</span>
                            </a>

                            <div id="langToggleWrapper" class="relative w-12 h-6">
                                <input type="checkbox" id="langToggle" class="sr-only" />
                                <div
                                    class="block bg-white/20 w-full h-full rounded-full cursor-pointer transition-colors duration-300">
                                </div>
                                <div id="langKnob"
                                    class="absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full shadow-md transform transition-transform duration-300">
                                </div>
                                <span id="langText"
                                    class="absolute -top-7 left-1/2 -translate-x-1/2 text-xs font-medium text-white select-none">EN</span>
                            </div>
                        </div>

                        <a href="#"
                            class="flex items-center space-x-3 text-white/90 hover:bg-white/15 hover:text-white p-2 rounded-md transition-colors duration-150 relative">
                            <span class="material-symbols-rounded">help</span>
                            <span data-translate-key="help_support">Help & Support</span>
                        </a>

                        <a href="#"
                            class="flex items-center space-x-3 text-red-400 hover:bg-red-500/20 hover:text-red-300 p-2 rounded-md transition-colors duration-150 relative mt-6"
                            id="logout-button"> <span class="material-symbols-rounded">logout</span>
                            <span data-translate-key="sign_out">Sign Out</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="flex-1 flex justify-center">
                <h1 class="text-2xl sm:text-3xl font-[Orbitron] tracking-widest">
                    <span class="text-[#facc15] drop-shadow-[0_0_6px_rgba(250,204,21,0.3)]">Suraksha</span>
                    <span class="text-white drop-shadow-[0_0_6px_rgba(255,255,255,0.3)]">Sathi</span>
                </h1>
            </div>

            <a href="profile_setting.html" class="flex w-12 items-center justify-end">
                <button
                    class="flex overflow-hidden rounded-full h-10 w-10 aspect-square bg-gradient-to-br from-blue-500 to-purple-600 text-white shadow-md">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=John" alt="Profile"
                        class="w-full h-full object-cover" />
                </button>
            </a>
        </div>

        <div class="fixed right-4 bottom-20 z-40 animate-fadeIn">
            <button onclick="window.location.href='report.html'"
                class="bg-alert-red text-white p-4 aspect-square w-14 h-14 rounded-full font-bold text-xl shadow-floating-action hover:scale-105 transition-transform duration-200 flex items-center justify-center animate-pulseOutline">
                <span class="material-symbols-rounded text-3xl">add_alert</span>
            </button>
        </div>

        <section
            class="relative bg-gradient-to-br from-neutral-900 via-orange-900/80 to-neutral-900 p-6 pt-10 pb-20 text-white overflow-hidden shadow-lg animate-fadeIn">
            <div class="absolute inset-0 z-0 opacity-30">
                <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice" fill="none">
                    <defs>
                        <filter id="blurry">
                            <feGaussianBlur in="SourceGraphic" stdDeviation="6" />
                        </filter>

                        <radialGradient id="grad1">
                            <stop offset="0%" stop-color="#fef3c7"></stop>
                            <stop offset="100%" stop-color="#f97316"></stop>
                        </radialGradient>
                        <radialGradient id="grad2">
                            <stop offset="0%" stop-color="#fed7aa"></stop>
                            <stop offset="100%" stop-color="#ea580c"></stop>
                        </radialGradient>
                        <linearGradient id="grad3">
                            <stop offset="0%" stop-color="#facc15"></stop>
                            <stop offset="100%" stop-color="#f97316"></stop>
                        </linearGradient>
                    </defs>

                    <circle cx="20" cy="80" r="18" fill="url(#grad1)" filter="url(#blurry)">
                        <animate attributeName="cx" values="20; 80; 20" dur="15s" repeatCount="indefinite" />
                        <animate attributeName="cy" values="80; 30; 80" dur="15s" repeatCount="indefinite" />
                    </circle>
                    <circle cx="90" cy="10" r="25" fill="url(#grad2)" filter="url(#blurry)">
                        <animate attributeName="cx" values="90; 10; 90" dur="18s" repeatCount="indefinite" />
                        <animate attributeName="cy" values="10; 90; 10" dur="18s" repeatCount="indefinite" />
                    </circle>
                    <rect x="50" y="50" width="30" height="30" fill="url(#grad3)" filter="url(#blurry)">
                        <animateTransform attributeName="transform" type="rotate" from="0 65 65" to="360 65 65"
                            dur="25s" repeatCount="indefinite" />
                        <animate attributeName="x" values="50; 20; 80; 50" dur="20s" repeatCount="indefinite" />
                    </rect>
                </svg>
            </div>
            <div class="absolute inset-0 backdrop-filter backdrop-blur-sm z-0 opacity-10 pointer-events-none"></div>

            <div class="relative z-10 max-w-md mx-auto">
                <div class="flex items-center gap-3 mb-4">
                    <span class="material-symbols-rounded text-3xl">location_on</span>
                    <div>
                        <p class="text-lg font-medium">Delhi, India</p>
                        <p class="text-xs opacity-70">District: Delhi | State: Delhi</p>
                    </div>
                </div>
                <h2 class="text-3xl font-bold mb-2" id="welcome-message">Welcome, John Doe!</h2>
                <p class="text-sm opacity-90 mb-4">Your safety and well-being are our top priority.</p>
                <div class="flex justify-between items-center bg-white/30 backdrop-blur-sm rounded-xl p-4 mt-6">
                    <div>
                        <p class="text-xl font-bold">14 <span class="text-lg font-normal">days</span></p>
                        <p class="text-sm opacity-90">Injury-Free</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xl font-bold">2 <span class="text-lg font-normal">incidents</span></p>
                        <p class="text-sm opacity-90">This month</p>
                    </div>
                </div>
            </div>
        </section>

        <main class="relative z-20 -mt-12 px-4 pb-20">

            <div class="grid grid-cols-2 gap-4 mb-6 animate-slideInUp">
                <a href="report.html"
                    class="bg-white/95 backdrop-blur-sm rounded-2xl p-5 text-center shadow-card hover:shadow-card-hover transition-shadow duration-300 flex flex-col items-center group">
                    <div
                        class="size-14 rounded-full bg-primary-light/30 text-primary-dark flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                        <span class="material-symbols-rounded text-3xl">sos</span>
                    </div>
                    <p class="font-semibold text-neutral-700">Emergency</p>
                    <p class="text-xs text-neutral-500 mt-1">Report an incident</p>
                </a>
                <a href="attendance.html"
                    class="bg-white/95 backdrop-blur-sm rounded-2xl p-5 text-center shadow-card hover:shadow-card-hover transition-shadow duration-300 flex flex-col items-center group">
                    <div
                        class="size-14 rounded-full bg-secondary/30 text-secondary flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                        <span class="material-symbols-rounded text-3xl">person_check</span>
                    </div>
                    <p class="font-semibold text-neutral-700">Attendance</p>
                    <p class="text-xs text-neutral-500 mt-1">Mark your presence</p>
                </a>
            </div>
            <div class="animated-card" id="video-of-the-day-container">
                <h3 class="text-lg font-bold text-neutral-800 mb-3 px-2">Video of the Day</h3>
                <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-card border border-neutral-200/80">
                    <div class="w-full rounded-lg overflow-hidden shadow-md mb-3" style="aspect-ratio: 16 / 9;">
                        <video class="w-full h-full object-cover" src="https://sundown-ivory.vercel.app/video.mp4"
                            poster="https://images.unsplash.com/photo-1571272314295-32d7a285dd17?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3"
                            controls muted preload="metadata" autoplay loop>
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div>
                        <p class="font-semibold text-neutral-700">Proper Use of Personal
                            Protective Equipment (PPE)</p>
                        <p class="text-sm text-neutral-500 mt-1">A 2-minute refresher on
                            correctly wearing and
                            inspecting your gear before every shift.</p>
                    </div>
                </div>
            </div>

            <div class="mt-4 mb-4 px-4 pt-2 space-y-4 space-x-5">
                <div class="animate-slideInUp delay-100">
                    <button onclick="window.location.href='checklist.html'"
                        class="w-full bg-gradient-to-r from-neutral-900 to-safety-orange text-white p-4 rounded-xl font-bold text-base shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2">
                        <span class="material-symbols-rounded">checklist</span>
                        <span data-translate-key="complete_checklist">Complete Your Checklist
                            Today</span>
                    </button>
                </div>

                <div
                    class="overflow-hidden rounded-2xl bg-white/70 backdrop-blur-lg border border-neutral-200 shadow-card animate-slideInUp delay-200">
                    <div class="flex flex-col gap-4 p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span
                                    class="material-symbols-rounded text-alert-red text-2xl animate-pulse">warning</span>
                                <h2 class="text-neutral-800 text-lg font-bold" data-translate-key="critical_alerts">
                                    Critical Alerts</h2>
                            </div>
                            <span class="badge bg-alert-red/10 text-alert-red font-semibold"
                                data-translate-key="active_alerts">2 active</span>
                        </div>

                        <div class="space-y-2" id="alerts-list">
                            <div
                                class="bg-alert-red/5 hover:bg-alert-red/10 transition-colors rounded-xl p-3 flex items-center gap-4">
                                <div
                                    class="bg-alert-red/10 h-10 w-10 aspect-square flex-shrink-0 rounded-full flex items-center justify-center">
                                    <span class="material-symbols-rounded text-alert-red">crisis_alert</span>
                                </div>
                                <div class="flex-1">
                                    <p class="text-neutral-800 font-semibold" data-translate-key="alert_gas_leak">Gas
                                        Leak Detected in Sector 3</p>
                                    <div class="flex items-center gap-2 mt-1 text-xs">
                                        <span class="font-bold text-alert-red" data-translate-key="high_priority">High
                                            priority</span>
                                        <span class="text-neutral-500" data-translate-key="five_min_ago">5 min
                                            ago</span>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="bg-secondary/5 hover:bg-secondary/10 transition-colors rounded-xl p-3 flex items-center gap-4">
                                <div
                                    class="bg-secondary/10 h-10 w-10 aspect-square flex-shrink-0 rounded-full flex items-center justify-center">
                                    <span class="material-symbols-rounded text-secondary">dangerous</span>
                                </div>
                                <div class="flex-1">
                                    <p class="text-neutral-800 font-semibold" data-translate-key="alert_rockfall">Minor
                                        Rockfall near Tunnel</p>
                                    <div class="flex items-center gap-2 mt-1 text-xs">
                                        <span class="font-bold text-secondary"
                                            data-translate-key="medium_priority">Medium priority</span>
                                        <span class="text-neutral-500" data-translate-key="thirty_min_ago">30 min
                                            ago</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button
                            class="mt-2 w-full bg-neutral-100 text-neutral-700 py-3 rounded-xl font-semibold text-base border border-neutral-200 hover:bg-neutral-200 transition-colors"
                            data-translate-key="view_all_incidents">
                            View All Incidents
                        </button>
                    </div>
                </div>

                <div class="animate-slideInUp delay-400" id="recent-activity-section">
                    <h2 class="text-lg font-bold mb-2 flex items-center gap-2 text-neutral-800">
                        <span class="material-symbols-rounded text-primary">history</span>
                        <span data-translate-key="recent_activity">Recent Activity</span>
                    </h2>
                    <div class="bg-white rounded-2xl p-4 shadow-card border border-neutral-200"
                        id="recent-activity-container">
                        <div class="space-y-3">
                            <div class="activity-item cursor-pointer group bg-neutral-50 hover:bg-neutral-100 rounded-lg p-3 transition-all duration-200 border border-transparent hover:border-neutral-200"
                                data-id="1">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="activity-icon bg-alert-red h-9 w-9 aspect-square rounded-full flex items-center justify-center flex-shrink-0 transform transition-transform duration-300 group-hover:scale-105">
                                        <span
                                            class="material-symbols-rounded text-white text-sm">notification_important</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="activity-title text-neutral-800 text-sm font-medium"
                                            data-translate-key="activity_gas_leak_title">Gas
                                            leak detected in Sector 3
                                        </p>
                                        <p class="activity-time text-neutral-500 text-xs"
                                            data-translate-key="activity_gas_leak_time">5 minutes ago</p>
                                    </div>
                                    <button
                                        class="activity-chevron text-neutral-400 transition-transform duration-300 group-hover:rotate-90">
                                        <span class="material-symbols-rounded">chevron_right</span>
                                    </button>
                                </div>

                                <div
                                    class="activity-details mt-3 text-sm text-neutral-600 max-h-0 overflow-hidden transition-all duration-300">
                                    <p data-translate-key="activity_gas_leak_details">Gas concentration reached 200ppm.
                                        Evacuated 5 personnel and notified
                                        control room. Investigation ongoing.</p>
                                    <div class="mt-3 flex gap-2">
                                        <button
                                            class="ack-btn bg-success-green text-white px-3 py-1 rounded-md text-sm">Acknowledge</button>
                                        <button
                                            class="view-btn bg-neutral-100 border border-neutral-200 px-3 py-1 rounded-md text-sm">View</button>
                                    </div>
                                </div>
                            </div>

                            <div class="activity-item cursor-pointer group bg-neutral-50 hover:bg-neutral-100 rounded-lg p-3 transition-all duration-200 border border-transparent hover:border-neutral-200"
                                data-id="2">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="activity-icon bg-success-green h-9 w-9 aspect-square rounded-full flex items-center justify-center flex-shrink-0 transform transition-transform duration-300 group-hover:scale-105">
                                        <span class="material-symbols-rounded text-white text-sm">check_circle</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="activity-title text-neutral-800 text-sm font-medium"
                                            data-translate-key="activity_inspection_title">
                                            Pre-shift inspection
                                            completed</p>
                                        <p class="activity-time text-neutral-500 text-xs"
                                            data-translate-key="activity_inspection_time">15 minutes ago
                                        </p>
                                    </div>
                                    <button
                                        class="activity-chevron text-neutral-400 transition-transform duration-300 group-hover:rotate-90">
                                        <span class="material-symbols-rounded">chevron_right</span>
                                    </button>
                                </div>
                                <div
                                    class="activity-details mt-3 text-sm text-neutral-600 max-h-0 overflow-hidden transition-all duration-300">
                                    <p data-translate-key="activity_inspection_details">All checks passed. Minor issues
                                        logged for maintenance team.</p>
                                    <div class="mt-3 flex gap-2">
                                        <button
                                            class="ack-btn bg-success-green text-white px-3 py-1 rounded-md text-sm">Acknowledge</button>
                                        <button
                                            class="view-btn bg-neutral-100 border border-neutral-200 px-3 py-1 rounded-md text-sm">View</button>
                                    </div>
                                </div>
                            </div>

                            <div class="activity-item cursor-pointer group bg-neutral-50 hover:bg-neutral-100 rounded-lg p-3 transition-all duration-200 border border-transparent hover:border-neutral-200"
                                data-id="3">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="activity-icon bg-safety-orange h-9 w-9 aspect-square rounded-full flex items-center justify-center flex-shrink-0 transform transition-transform duration-300 group-hover:scale-105">
                                        <span class="material-symbols-rounded text-white text-sm">warning</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="activity-title text-neutral-800 text-sm font-medium"
                                            data-translate-key="activity_rockfall_title">
                                            Minor rockfall reported near
                                            Tunnel A</p>
                                        <p class="activity-time text-neutral-500 text-xs"
                                            data-translate-key="activity_rockfall_time">30 minutes ago</p>
                                    </div>
                                    <button
                                        class="activity-chevron text-neutral-400 transition-transform duration-300 group-hover:rotate-90">
                                        <span class="material-symbols-rounded">chevron_right</span>
                                    </button>
                                </div>
                                <div
                                    class="activity-details mt-3 text-sm text-neutral-600 max-h-0 overflow-hidden transition-all duration-300">
                                    <p data-translate-key="activity_rockfall_details">Small debris observed, area
                                        cordoned off for inspection. No
                                        injuries.</p>
                                    <div class="mt-3 flex gap-2">
                                        <button
                                            class="ack-btn bg-success-green text-white px-3 py-1 rounded-md text-sm">Acknowledge</button>
                                        <button
                                            class="view-btn bg-neutral-100 border border-neutral-200 px-3 py-1 rounded-md text-sm">View</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="animate-slideInUp delay-500" id="progress-section">
                    <h2 class="text-lg font-bold mb-2 flex items-center gap-2 text-neutral-800">
                        <span class="material-symbols-rounded text-primary">trending_up</span>
                        <span data-translate-key="your_progress">Your Progress</span>
                    </h2>
                    <div class="bg-white rounded-2xl p-4 shadow-card border border-neutral-200" id="progress-box">
                        <div class="mb-4 progress-row" data-target="75">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-rounded text-success-green">school</span>
                                    <p class="progress-title text-neutral-800 text-sm font-medium"
                                        data-translate-key="safety_training">Safety Training</p>
                                </div>
                                <span class="progress-value text-neutral-600 font-medium">0%</span>
                            </div>
                            <div class="w-full bg-neutral-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-success-green to-primary h-2 rounded-full progress-bar"
                                    style="--progress-width: 0%;"></div>
                            </div>
                        </div>

                        <div class="progress-row" data-target="60">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-rounded text-primary">lightbulb</span>
                                    <p class="progress-title text-neutral-800 text-sm font-medium"
                                        data-translate-key="knowledge_base">Knowledge Base</p>
                                </div>
                                <span class="progress-value text-neutral-600 font-medium">0%</span>
                            </div>
                            <div class="w-full bg-neutral-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-primary to-badge-purple h-2 rounded-full progress-bar"
                                    style="--progress-width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pb-16 animate-slideInUp delay-400">
                    <h2 class="text-lg font-bold mb-2 flex items-center gap-2 text-neutral-800">
                        <span class="material-symbols-rounded text-badge-gold">emoji_events</span>
                        <span data-translate-key="your_badges">Your Badges</span>
                    </h2>
                    <div class="overflow-x-auto py-2 -mx-4 px-4">
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 flex flex-col items-center animate-badgePop" style="width: 76px">
                                <div
                                    class="w-16 h-16 aspect-square bg-gradient-to-br from-badge-gold to-badge-orange rounded-full flex items-center justify-center shadow-lg">
                                    <span class="material-symbols-rounded text-white text-2xl">military_tech</span>
                                </div>
                                <p class="text-neutral-800 text-xs font-medium text-center mt-2"
                                    data-translate-key="badge_safety_master">Safety Master</p>
                            </div>

                            <div class="flex-shrink-0 flex flex-col items-center animate-badgePop delay-100"
                                style="width: 76px">
                                <div
                                    class="w-16 h-16 aspect-square bg-gradient-to-br from-badge-silver to-neutral-400 rounded-full flex items-center justify-center shadow-lg">
                                    <span class="material-symbols-rounded text-white text-2xl">emergency</span>
                                </div>
                                <p class="text-neutral-800 text-xs font-medium text-center mt-2"
                                    data-translate-key="badge_first_responder">First Responder</p>
                            </div>

                            <div class="flex-shrink-0 flex flex-col items-center animate-badgePop delay-200"
                                style="width: 76px">
                                <div
                                    class="w-16 h-16 aspect-square bg-gradient-to-br from-badge-purple to-primary-dark rounded-full flex items-center justify-center shadow-lg">
                                    <span class="material-symbols-rounded text-white text-2xl">quiz</span>
                                </div>
                                <p class="text-neutral-800 text-xs font-medium text-center mt-2"
                                    data-translate-key="badge_quiz_whiz">Quiz Whiz</p>
                            </div>

                            <div class="flex-shrink-0 flex flex-col items-center animate-badgePop delay-300"
                                style="width: 76px">
                                <div
                                    class="w-16 h-16 aspect-square bg-gradient-to-br from-badge-bronze to-badge-orange rounded-full flex items-center justify-center shadow-lg">
                                    <span class="material-symbols-rounded text-white text-2xl">play_circle</span>
                                </div>
                                <p class="text-neutral-800 text-xs font-medium text-center mt-2"
                                    data-translate-key="badge_video_learner">Video Learner</p>
                            </div>

                            <div class="flex-shrink-0 flex flex-col items-center animate-badgePop delay-400"
                                style="width: 76px">
                                <div
                                    class="w-16 h-16 aspect-square bg-gradient-to-br from-badge-blue to-primary-dark rounded-full flex items-center justify-center shadow-lg">
                                    <span
                                        class="material-symbols-rounded text-white text-2xl">notifications_active</span>
                                </div>
                                <p class="text-neutral-800 text-xs font-medium text-center mt-2"
                                    data-translate-key="badge_alert_hero">Alert Hero</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <nav
                class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-[#020617] via-[#0f172a] to-[#000000] border-t border-white/10 shadow-bottom-nav z-40">
                <div class="flex justify-around">
                    <a href="home2.html"
                        class="nav-link active flex flex-col items-center justify-center pt-3 pb-2 w-1/4 text-primary group">
                        <div class="nav-icon-wrapper">
                            <span class="material-symbols-rounded text-xl group-hover:animate-bounce">home</span>
                        </div>
                        <span class="text-xs font-medium mt-1 group-hover:animate-pulse"
                            data-translate-key="nav_home">Home</span>
                    </a>

                    <a href="video_library.html"
                        class="nav-link flex flex-col items-center justify-center pt-3 pb-2 w-1/4 text-neutral-500 group">
                        <div class="nav-icon-wrapper">
                            <span
                                class="material-symbols-rounded text-xl group-hover:animate-spin-slow">video_library</span>
                        </div>
                        <span class="text-xs font-medium mt-1 group-hover:animate-pulse"
                            data-translate-key="nav_library">Library</span>
                    </a>

                    <a href="checklist.html"
                        class="nav-link flex flex-col items-center justify-center pt-3 pb-2 w-1/4 text-neutral-500 group">
                        <div class="nav-icon-wrapper">
                            <span class="material-symbols-rounded text-xl group-hover:animate-bounce">checklist</span>
                        </div>
                        <span class="text-xs font-medium mt-1 group-hover:animate-pulse"
                            data-translate-key="nav_checklists">Checklists</span>
                    </a>

                    <a href="shorts.html"
                        class="nav-link flex flex-col items-center justify-center pt-3 pb-2 w-1/4 text-neutral-500 group">
                        <div class="nav-icon-wrapper">
                            <span class="material-symbols-rounded text-xl group-hover:animate-pulse">videocam</span>
                        </div>
                        <span class="text-xs font-medium mt-1 group-hover:animate-pulse"
                            data-translate-key="nav_videos">Shorts</span>
                    </a>
                </div>
            </nav>
        </main>
    </div>

    <script>
        // Toggle main menu
        const menuToggle = document.getElementById("menu-toggle");
        const menu = document.getElementById("menu");

        // Close menu when clicking outside
        document.addEventListener("click", function (event) {
            if (!menu.contains(event.target) && event.target !== menuToggle && !event.target.closest('label[for="menu-toggle"]')) {
                menuToggle.checked = false;
                menu.style.maxHeight = "0";
                menu.style.opacity = "0";
            }
        });

        menuToggle.addEventListener("change", function () {
            if (this.checked) {
                menu.style.maxHeight = "100vh";
                menu.style.opacity = "1";
            } else {
                menu.style.maxHeight = "0";
                menu.style.opacity = "0";
            }
        });
    </script>

    <style>
        /* Slide down header entrance */
        @keyframes slideInDown {
            from {
                transform: translateY(-8px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        /* Shimmer for progress and critical alerts */
        @keyframes shine {
            0% {
                transform: translateX(-100%)
            }

            100% {
                transform: translateX(100%)
            }
        }

        /* Nav entrance */
        header.nav-animate {
            animation: slideInDown 360ms ease-out both;
        }

        header.nav-notify {
            box-shadow: 0 10px 30px rgba(2, 132, 199, 0.12);
            border-color: rgba(2, 132, 199, 0.06);
        }

        /* Badge pop + float */
        .badge-animate {
            animation: badgePop 0.55s cubic-bezier(.16, .84, .44, 1) both, floatUp 3.8s ease-in-out infinite;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-6px)
            }

            100% {
                transform: translateY(0)
            }
        }

        /* Critical alert shimmer overlay */
        .critical-alert {
            position: relative;
            overflow: hidden;
        }

        .critical-alert::after {
            content: '';
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.06) 50%, rgba(255, 255, 255, 0) 100%);
            transform: translateX(-120%);
            animation: shine 2s linear infinite;
            opacity: 0.6;
            mix-blend-mode: overlay;
        }

        /* Progress bar styling & shimmer */
        .progress-bar {
            width: 0;
            transition: width 1.2s ease-out;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.12) 50%, rgba(255, 255, 255, 0.06) 100%);
            transform: translateX(-120%);
        }

        .progress-bar.shine::after {
            animation: shine 1.6s linear forwards;
        }

        /* Small pop for recent activity rows */
        .activity-item.expand {
            box-shadow: 0 12px 30px rgba(2, 132, 199, 0.06);
            transform: translateY(-3px);
        }

        /* Ensure transitions look smooth on theme backgrounds */
        .glassmorphism,
        header {
            transition: box-shadow .25s ease, border-color .25s ease, transform .18s ease;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Header entrance animation
            const header = document.querySelector('header');
            if (header) {
                header.classList.add('nav-animate');
                // If there are notifications, give the nav a subtle glow briefly
                const notifCount = document.querySelector('#btn-notifications span');
                if (notifCount && parseInt(notifCount.innerText || '0', 10) > 0) {
                    header.classList.add('nav-notify');
                    setTimeout(() => header.classList.remove('nav-notify'), 1400);
                }
            }

            // Enhance badges: add additional animation class and stagger them
            const badgeEls = document.querySelectorAll('.animate-badgePop');
            badgeEls.forEach((el, i) => {
                setTimeout(() => el.classList.add('badge-animate'), 120 * i);
            });

            // Critical alerts: find the critical alerts container and add shimmer + outline animation
            const criticalSection = document.querySelector('.overflow-hidden.rounded-2xl.bg-gradient-to-r.from-alert-red');
            if (criticalSection) {
                const alertItems = criticalSection.querySelectorAll('.space-y-3 > div');
                alertItems.forEach(item => {
                    item.classList.add('critical-alert');
                    const icon = item.querySelector('.animate-pulse');
                    if (icon) icon.classList.add('animate-pulse-outline');
                });
            }

            // When progress bars are filled (set by other script), add a shimmer for a short time
            setTimeout(() => {
                document.querySelectorAll('.progress-bar').forEach(bar => {
                    const w = parseFloat(bar.style.width || bar.getAttribute('data-width') || '0');
                    if (w && w > 0) {
                        bar.classList.add('shine');
                        // Remove shine after one cycle
                        setTimeout(() => bar.classList.remove('shine'), 1600);
                    }
                });
            }, 1100);

            // Add small hover micro-interactions for alert ack buttons
            document.querySelectorAll('.ack-btn').forEach(btn => {
                btn.addEventListener('mouseenter', () => btn.classList.add('scale-105'));
                btn.addEventListener('mouseleave', () => btn.classList.remove('scale-105'));
            });

            // When an activity details expand, add a class for extra pop
            document.querySelectorAll('.activity-item').forEach(item => {
                const details = item.querySelector('.activity-details');
                item.addEventListener('transitionend', () => {
                    if (details.style.maxHeight && details.style.maxHeight !== '0px') {
                        item.classList.add('expand');
                        setTimeout(() => item.classList.remove('expand'), 700);
                    }
                });
            });
        });
    </script>

    <div id="chatbot-container" class="fixed bottom-20 left-4 z-50">

        <div id="chat-window"
            class="w-80 md:w-96 h-[30rem] md:h-[33rem] bg-white rounded-2xl shadow-2xl flex flex-col transform scale-95 opacity-0 pointer-events-none origin-bottom-left">

            <div
                class="flex items-center justify-between p-4 bg-gradient-to-br from-sky-600 to-sky-700 text-white rounded-t-2xl shadow-md">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-rounded text-3xl text-sky-200">smart_toy</span>
                    <h3 class="font-bold text-lg"> </h3>
                </div>
                <button id="close-chat-btn" class="p-1 rounded-full hover:bg-white/20">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>

            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4 bg-slate-50">
                <div class="flex justify-start gap-2.5">
                    <div class="chat-bubble chat-bubble-bot p-3 rounded-xl rounded-tl-none">
                        <p>   <b> </b>     !
                                        
                                
                             
                            ,        ?</p>
                    </div>
                </div>
            </div>

            <div class="p-3 border-t border-slate-200 bg-white rounded-b-2xl">
                <form id="chat-form" class="flex items-center gap-2 mb-2">
                    <input id="chat-input" type="text" placeholder="  ..."
                        class="flex-1 px-4 py-2 bg-slate-100 border border-transparent rounded-full focus:ring-2 focus:ring-sky-500 focus:border-sky-500" />
                    <button id="chat-submit-btn" type="submit"
                        class="p-2 w-10 h-10 flex items-center justify-center bg-sky-600 text-white rounded-full hover:bg-sky-700 transition">
                        <span class="material-symbols-rounded">send</span>
                    </button>
                </form>

                <div class="grid grid-cols-2 gap-2">
                    <button
                        class="quick-btn bg-orange-100 hover:bg-orange-200 text-orange-700 rounded-full py-2 text-sm font-medium"
                        data-message="  ">  </button>
                    <button
                        class="quick-btn bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-full py-2 text-sm font-medium"
                        data-message=" "> </button>
                    <button
                        class="quick-btn bg-green-100 hover:bg-green-200 text-green-700 rounded-full py-2 text-sm font-medium"
                        data-message="  "> </button>
                    <button
                        class="quick-btn bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-full py-2 text-sm font-medium"
                        data-message="  "> </button>
                </div>
            </div>
        </div>

        <button id="open-chat-btn"
            class="w-16 h-16 bg-gradient-to-br from-sky-500 to-sky-600 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-300 transform hover:scale-110"
            style="animation: pulse-glow 2.5s infinite;">
            <span id="open-chat-icon" class="material-symbols-rounded text-3xl">support_agent</span>
        </button>
    </div>

    <script src="../api.client.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const openBtn = document.getElementById('open-chat-btn');
            const closeBtn = document.getElementById('close-chat-btn');
            const chatWin = document.getElementById('chat-window');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const chatMsgs = document.getElementById('chat-messages');
            const openIcon = document.getElementById('open-chat-icon');
            const quickBtns = document.querySelectorAll('.quick-btn');

            const API_KEY = ""; // Add your Gemini API key
            // NOTE: The model and endpoint have been updated for better performance
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;

            let chatHistory = [];

            openBtn.addEventListener('click', toggleChat);
            closeBtn.addEventListener('click', toggleChat);
            chatForm.addEventListener('submit', sendMessage);
            quickBtns.forEach(btn => btn.addEventListener('click', () => {
                chatInput.value = btn.dataset.message;
                chatForm.requestSubmit();
            }));

            function toggleChat() {
                // Changed class manipulation for origin-bottom-left (chatbot is now on the left)
                const isOpen = !chatWin.classList.contains('pointer-events-none');
                if (isOpen) {
                    chatWin.classList.add('scale-95', 'opacity-0', 'pointer-events-none');
                    // Change the origin for the closing animation
                    chatWin.classList.remove('origin-bottom-left');
                    chatWin.classList.add('origin-bottom-left');
                    openIcon.textContent = 'support_agent';
                } else {
                    // Change the origin for the opening animation
                    chatWin.classList.remove('origin-bottom-left');
                    chatWin.classList.add('origin-bottom-left');
                    chatWin.classList.remove('scale-95', 'opacity-0', 'pointer-events-none');
                    openIcon.textContent = 'close';
                    chatInput.focus();
                }
            }

            async function sendMessage(e) {
                e.preventDefault();
                const text = chatInput.value.trim();
                if (!text) return;

                appendMsg(text, 'user');
                chatInput.value = '';

                showThinking();

                try {
                    const reply = await getBotReply(text);
                    appendMsg(reply, 'bot');
                } catch (err) {
                    appendMsg(" ,        ", 'bot');
                    console.error(err);
                } finally {
                    removeThinking();
                }
            }

            function appendMsg(msg, sender) {
                const wrap = document.createElement('div');
                const bubble = document.createElement('div');
                wrap.className = sender === 'user' ? 'flex justify-end' : 'flex justify-start gap-2.5';
                bubble.className = sender === 'user' ?
                    'chat-bubble chat-bubble-user p-3 rounded-xl rounded-br-none' :
                    'chat-bubble chat-bubble-bot p-3 rounded-xl rounded-bl-none';
                bubble.innerHTML = msg.replace(/\n/g, '<br>');
                wrap.appendChild(bubble);
                chatMsgs.appendChild(wrap);
                chatMsgs.scrollTop = chatMsgs.scrollHeight;
            }

            function showThinking() {
                const div = document.createElement('div');
                div.id = 'thinking';
                div.className = 'flex justify-start gap-2.5';
                div.innerHTML = `<div class="chat-bubble chat-bubble-bot p-3 rounded-xl rounded-bl-none">
                    <div class="thinking-indicator flex space-x-1.5"><span></span><span></span><span></span></div>
                </div>`;
                chatMsgs.appendChild(div);
                chatMsgs.scrollTop = chatMsgs.scrollHeight;
            }

            function removeThinking() {
                const t = document.getElementById('thinking');
                if (t) t.remove();
            }

            async function getBotReply(userInput) {
                // NOTE: The prompt has been slightly adjusted to use the latest model reference.
                const sysPrompt = `
                     " "        
                                        
                     :
                    - "": updated-home-page.html
                    - "": report.html
                    - "": checklist.html
                    - " ": map.html
                    - "": leaderboard.html
                    - " ": video_library.html
                    - " ": shorts.html
                    - "": profile_setting.html
                    - " ": admin-home.html
                    - "": login.html

                    :
                    1.     
                    2.        ,  HTML  
                    : "<a href='report.html' class='font-bold underline text-sky-700'> </a>"
                    3.  ,    
                    4.    ,  : "       ?"`;

                chatHistory.push({
                    role: "user",
                    parts: [{
                        text: userInput
                    }]
                });

                const payload = {
                    contents: chatHistory,
                    config: {
                        systemInstruction: sysPrompt
                    },
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 250
                    }
                };

                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text;
                chatHistory.push({
                    role: "model",
                    parts: [{
                        text: reply
                    }]
                });
                return reply || "    ,   ";
            }
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const langToggle = document.getElementById("langToggle");
            const knob = document.getElementById("langKnob");
            const langText = document.getElementById("langText");

            const translations = {
                suraksha: {
                    en: "Safety",
                    hi: ""
                },
                sathi: {
                    en: "Saarthi",
                    hi: ""
                },
                // Menu
                settings: {
                    en: "Settings",
                    hi: ""
                },
                video_library_menu: {
                    en: "Video Library",
                    hi: " "
                },
                help_support: {
                    en: "Help & Support",
                    hi: "  "
                },
                language: {
                    en: "Language",
                    hi: ""
                },
                sign_out: {
                    en: "Sign Out",
                    hi: " "
                },

                // Header
                welcome_greeting: {
                    en: "Welcome back, John!",
                    hi: "   , !"
                },
                date_string: {
                    en: "Monday, 28 October 2024",
                    hi: ", 28  2024"
                },
                all_clear: {
                    en: "All clear",
                    hi: "  "
                },

                // Video section
                video_of_day: {
                    en: "Video of the Day",
                    hi: "  "
                },
                video_description: {
                    en: "Safety Protocol: Emergency Evacuation",
                    hi: " :  "
                },

                // Main button
                complete_checklist: {
                    en: "Complete Your Checklist Today",
                    hi: "     "
                },

                // Alerts section
                critical_alerts: {
                    en: "Critical Alerts",
                    hi: " "
                },
                active_alerts: {
                    en: "2 active",
                    hi: "2 "
                },
                alert_gas_leak: {
                    en: "Gas Leak Detected in Sector 3",
                    hi: " 3      "
                },
                high_priority: {
                    en: "High priority",
                    hi: " "
                },
                five_min_ago: {
                    en: "5 min ago",
                    hi: "5  "
                },
                alert_rockfall: {
                    en: "Minor Rockfall near Tunnel",
                    hi: "     "
                },
                medium_priority: {
                    en: "Medium priority",
                    hi: " "
                },
                thirty_min_ago: {
                    en: "30 min ago",
                    hi: "30  "
                },
                view_all_incidents: {
                    en: "View All Incidents",
                    hi: "  "
                },

                // Map section
                safety_map: {
                    en: "Safety Map",
                    hi: " "
                },
                map_alerts: {
                    en: "Alerts",
                    hi: ""
                },
                map_personnel: {
                    en: "Personnel",
                    hi: ""
                },

                // Recent Activity
                recent_activity: {
                    en: "Recent Activity",
                    hi: "  "
                },
                activity_gas_leak_title: {
                    en: "Gas leak detected in Sector 3",
                    hi: " 3      "
                },
                activity_gas_leak_time: {
                    en: "5 minutes ago",
                    hi: "5  "
                },
                activity_gas_leak_details: {
                    en: "Gas concentration reached 200ppm. Evacuated 5 personnel and notified control room. Investigation ongoing.",
                    hi: "   200ppm    5              "
                },
                acknowledge_button: {
                    en: "Acknowledge",
                    hi: " "
                },
                view_button: {
                    en: "View",
                    hi: ""
                },
                activity_inspection_title: {
                    en: "Pre-shift inspection completed",
                    hi: "-   "
                },
                activity_inspection_time: {
                    en: "15 minutes ago",
                    hi: "15  "
                },
                activity_inspection_details: {
                    en: "All checks passed. Minor issues logged for maintenance team.",
                    hi: "              "
                },
                activity_rockfall_title: {
                    en: "Minor rockfall reported near Tunnel A",
                    hi: "         "
                },
                activity_rockfall_time: {
                    en: "30 minutes ago",
                    hi: "30  "
                },
                activity_rockfall_details: {
                    en: "Small debris observed, area cordoned off for inspection. No injuries.",
                    hi: "   ,            "
                },

                // Progress Section
                your_progress: {
                    en: "Your Progress",
                    hi: " "
                },
                safety_training: {
                    en: "Safety Training",
                    hi: " "
                },
                knowledge_base: {
                    en: "Knowledge Base",
                    hi: ""
                },

                // Badges Section
                your_badges: {
                    en: "Your Badges",
                    hi: " "
                },
                badge_safety_master: {
                    en: "Safety Master",
                    hi: " "
                },
                badge_first_responder: {
                    en: "First Responder",
                    hi: " "
                },
                badge_quiz_whiz: {
                    en: "Quiz Whiz",
                    hi: " "
                },
                badge_video_learner: {
                    en: "Video Learner",
                    hi: " "
                },
                badge_alert_hero: {
                    en: "Alert Hero",
                    hi: " "
                },

                // Bottom Nav
                nav_home: {
                    en: "Home",
                    hi: ""
                },
                nav_library: {
                    en: "Library",
                    hi: ""
                },
                nav_checklists: {
                    en: "Checklists",
                    hi: ""
                },
                nav_videos: {
                    en: "Videos",
                    hi: ""
                }
            };

            // Load saved language (default English)
            let currentLang = localStorage.getItem("lang") || "en";

            // Apply initial state
            applyLanguage(currentLang);

            // Handle toggle click
            document.getElementById("langToggleWrapper").addEventListener("click", (e) => {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();

                // Flip language
                currentLang = currentLang === "en" ? "hi" : "en";
                localStorage.setItem("lang", currentLang);
                applyLanguage(currentLang);
            });

            function applyLanguage(lang) {
                // Update toggle switch UI
                if (lang === "hi") {
                    knob.style.transform = "translateX(24px)";
                    langText.textContent = "HI";
                    document.documentElement.lang = 'hi';
                } else {
                    knob.style.transform = "translateX(0)";
                    langText.textContent = "EN";
                    document.documentElement.lang = 'en';
                }

                // Update all elements with data-translate-key attribute
                document.querySelectorAll("[data-translate-key]").forEach(element => {
                    const key = element.getAttribute("data-translate-key");
                    if (translations[key] && translations[key][lang]) {
                        element.textContent = translations[key][lang];
                    }
                });

                // Special case for buttons that appear multiple times
                document.querySelectorAll('.ack-btn').forEach(btn => btn.textContent = translations['acknowledge_button'][lang]);
                document.querySelectorAll('.view-btn').forEach(btn => btn.textContent = translations['view_button'][lang]);
            }
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // --- 1. AUTHENTICATION & INITIALIZATION ---
            const token = localStorage.getItem("token");
            const user = JSON.parse(localStorage.getItem("user"));

            // If no token or user data, redirect to login page
            if (!token || !user) {
                window.location.href = "../index.html";
                return;
            }

            // --- 2. RENDER FUNCTIONS (To create dynamic HTML) ---

            /**
             * Renders the welcome message and profile picture.
             */
            const renderWelcomeHeader = (currentUser) => {
                const welcomeMessage = document.getElementById("welcome-message");
                const profileImage = document.getElementById("profile-image");

                if (welcomeMessage && currentUser.fullName) {
                    welcomeMessage.textContent = `Welcome, ${currentUser.fullName}!`;
                }
                if (profileImage) {
                    // Uses DiceBear Avatars with the username as a seed for a unique avatar
                    profileImage.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${currentUser.fullName || 'default'}`;
                }
            };

            /**
             * Renders the Critical Alerts section.
             * @param {Array} alerts - An array of notification objects.
             */
            const appendCriticalAlerts = (alerts) => {
                // Target the specific list element you added the ID to
                const container = document.getElementById("alerts-list");
                if (!container || !alerts || alerts.length === 0) return;

                const alertsHTML = alerts.map(alert => `
                    <div class="bg-alert-red/5 hover:bg-alert-red/10 rounded-xl p-3 flex items-center gap-4">
                        <div class="bg-alert-red/10 h-10 w-10 aspect-square rounded-full flex items-center justify-center">
                            <span class="material-symbols-rounded text-alert-red">crisis_alert</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-neutral-800 font-semibold">${alert.message}</p>
                            <div class="flex items-center gap-2 mt-1 text-xs text-neutral-500">
                                <span>${new Date(alert.createdAt).toLocaleString()}</span>
                            </div>
                        </div>
                    </div>`).join('');

                // Use insertAdjacentHTML to add to the end of the list
                container.insertAdjacentHTML('afterbegin', alertsHTML);

                // Update the active alerts count badge
                const badge = document.getElementById("active-alerts-badge");
                const currentCount = container.children.length; // Get total count of items in the list
                if (badge) {
                    badge.textContent = `${currentCount} active`;
                }
            };


            /**
             * Renders the Recent Activity section.
             * @param {Array} activities - An array of notification objects.
             */
            const appendRecentActivity = (activities) => {
                // Target the container for activity items
                const container = document.getElementById("recent-activity-container");
                if (!container || !activities || activities.length === 0) return;

                const activitiesHTML = activities.map(activity => `
                    <div class="activity-item cursor-pointer group bg-neutral-50 hover:bg-neutral-100 rounded-lg p-3">
                        <div class="flex items-center gap-3">
                            <div class="activity-icon bg-blue-500 h-9 w-9 aspect-square rounded-full flex items-center justify-center">
                                <span class="material-symbols-rounded text-white text-sm">info</span>
                            </div>
                            <div class="flex-1">
                                <p class="activity-title text-neutral-800 text-sm font-medium">${activity.message}</p>
                                <p class="activity-time text-neutral-500 text-xs">${new Date(activity.createdAt).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>`).join('');

                // Use insertAdjacentHTML to add to the end of the list
                container.insertAdjacentHTML('afterbegin', activitiesHTML);
            };

            const renderVideoOfTheDay = (videoData) => {
                const videoElement = document.querySelector("#video-of-the-day-container video");
                const titleElement = document.querySelector("#video-of-the-day-container .font-semibold");
                const descriptionElement = document.querySelector("#video-of-the-day-container .text-sm");

                if (!videoElement || !videoData) {
                    console.warn("Video of the day elements not found or no video data provided.");
                    return;
                }

                // Assuming videoData has properties like: videoUrl, thumbnailUrl, title, description
                if (videoData.videoUrl) videoElement.src = videoData.videoUrl;
                if (videoData.thumbnailUrl) videoElement.poster = videoData.thumbnailUrl;
                if (titleElement && videoData.title) titleElement.textContent = videoData.title;
                if (descriptionElement && videoData.description) descriptionElement.textContent = videoData.description;
            };

            // --- 3. API CALLS & PAGE POPULATION ---

            const initializeDashboard = async () => {
                try {
                    // Fetch current user details for personalization
                    const currentUser = await authAPI.getCurrentUser();
                    renderWelcomeHeader(currentUser.data);

                    const notificationResponse = await notificationAPI.getForUser(user._id);

                    // The actual array is in the .data property of the response
                    const notifications = notificationResponse.data;

                    // You can customize this based on your notification data structure
                    const criticalAlerts = notifications.filter(n => n.type === 'alert').slice(0, 2); // Show max 2 alerts
                    const recentActivities = notifications.filter(n => n.type !== 'alert').slice(0, 3); // Show max 3 activities

                    if (Array.isArray(notifications)) {
                        const criticalAlerts = notifications.filter(n => n.type === 'alert');
                        const recentActivities = notifications.filter(n => n.type !== 'alert');

                        // Call the new functions
                        appendCriticalAlerts(criticalAlerts);
                        appendRecentActivity(recentActivities);
                    }

                    const videoResponse = await dailyVideoAPI.getForUser(user._id);
                    if (videoResponse && videoResponse.data) {
                        renderVideoOfTheDay(videoResponse.data);
                    }

                } catch (error) {
                    console.error("Failed to initialize dashboard:", error);
                    // If token is invalid or expired (401 error), log out the user
                    if (error.message && error.message.includes("401")) {
                        localStorage.removeItem("token");
                        localStorage.removeItem("user");
                        window.location.href = "../index.html";
                    }
                }
            };

            // --- 4. EVENT LISTENERS ---

            // Logout button functionality
            const logoutButton = document.getElementById("logout-button");
            if (logoutButton) {
                logoutButton.addEventListener("click", async (e) => {
                    e.preventDefault();
                    try {
                        await authAPI.logout();
                    } catch (error) {
                        console.error("Server logout failed, clearing session locally.", error);
                    } finally {
                        // Always clear local storage and redirect
                        localStorage.removeItem("token");
                        localStorage.removeItem("user");
                        window.location.href = "../index.html";
                    }
                });
            }

            // --- 5. INITIALIZE THE PAGE ---
            initializeDashboard();
        });
    </script>

</body>

</html>